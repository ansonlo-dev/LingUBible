# ğŸ”§ Appwrite å‡½æ•¸ä½¿ç”¨ç‹€æ³åˆ†æ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æª”åˆ†æ Campus Comment Verse é …ç›®ä¸­ Appwrite é›²å‡½æ•¸çš„ä½¿ç”¨ç‹€æ³ï¼Œå¹«åŠ©è­˜åˆ¥å“ªäº›å‡½æ•¸æ­£åœ¨ä½¿ç”¨ï¼Œå“ªäº›å¯èƒ½æ˜¯æœªä½¿ç”¨çš„ã€‚

## ğŸ“ å‡½æ•¸ç›®éŒ„çµæ§‹

```
functions/
â”œâ”€â”€ ğŸ“§ send-verification-email/     # âœ… æ­£åœ¨ä½¿ç”¨
â”œâ”€â”€ ğŸ§¹ cleanup-expired-codes/       # âœ… æ­£åœ¨ä½¿ç”¨ (å®šæ™‚ä»»å‹™)
â”œâ”€â”€ ğŸ“® send-contact-email/          # âŒ æœªä½¿ç”¨
â””â”€â”€ ğŸ” verify-student-code/         # âŒ æœªå®Œæ•´å¯¦ç¾
```

## ğŸ“Š å‡½æ•¸ä½¿ç”¨ç‹€æ³è©³ç´°åˆ†æ

### âœ… æ­£åœ¨ä½¿ç”¨çš„å‡½æ•¸

#### 1. `send-verification-email`
- **ç‹€æ…‹**: âœ… æ´»èºä½¿ç”¨
- **é…ç½®**: å·²åœ¨ `appwrite.json` ä¸­å®šç¾©
- **éƒ¨ç½²**: å·²éƒ¨ç½²åˆ° Appwrite Console
- **ç”¨é€”**: ç™¼é€å­¸ç”Ÿéƒµç®±é©—è­‰ç¢¼
- **èª¿ç”¨ä½ç½®**:
  - `src/services/external/studentVerification.ts` (2 è™•)
  - `src/services/api/auth.ts` (1 è™•)
- **åŸ·è¡Œæ–¹å¼**: æ‰‹å‹•è§¸ç™¼ (API èª¿ç”¨)

#### 2. `cleanup-expired-codes`
- **ç‹€æ…‹**: âœ… æ´»èºä½¿ç”¨
- **é…ç½®**: å·²åœ¨ `appwrite.json` ä¸­å®šç¾©
- **éƒ¨ç½²**: å·²éƒ¨ç½²åˆ° Appwrite Console
- **ç”¨é€”**: æ¸…ç†éæœŸçš„é©—è­‰ç¢¼
- **èª¿ç”¨ä½ç½®**: ç„¡ç›´æ¥èª¿ç”¨ (å®šæ™‚ä»»å‹™)
- **åŸ·è¡Œæ–¹å¼**: å®šæ™‚åŸ·è¡Œ (`0 */6 * * *` - æ¯ 6 å°æ™‚)

### âŒ æœªä½¿ç”¨çš„å‡½æ•¸

#### 3. `send-contact-email`
- **ç‹€æ…‹**: âŒ æœªä½¿ç”¨
- **é…ç½®**: æœªåœ¨ `appwrite.json` ä¸­å®šç¾©
- **éƒ¨ç½²**: æœªéƒ¨ç½²
- **ç”¨é€”**: ç™¼é€è¯ç¹«è¡¨å–®éƒµä»¶
- **èª¿ç”¨ä½ç½®**: ç„¡
- **å•é¡Œ**: 
  - ä»£ç¢¼å·²å¯¦ç¾ä½†æœªé…ç½®
  - é …ç›®ä¸­æ²’æœ‰è¯ç¹«è¡¨å–®åŠŸèƒ½
  - å¯èƒ½æ˜¯è¨ˆåŠƒä¸­çš„åŠŸèƒ½

#### 4. `verify-student-code`
- **ç‹€æ…‹**: âŒ æœªå®Œæ•´å¯¦ç¾
- **é…ç½®**: æœªåœ¨ `appwrite.json` ä¸­å®šç¾©
- **éƒ¨ç½²**: æœªéƒ¨ç½²
- **ç”¨é€”**: é©—è­‰å­¸ç”Ÿä»£ç¢¼ (æ¨æ¸¬)
- **èª¿ç”¨ä½ç½®**: ç„¡
- **å•é¡Œ**:
  - ç›®éŒ„å­˜åœ¨ä½†ç„¡ `main.js` æ–‡ä»¶
  - åŠŸèƒ½æœªå¯¦ç¾
  - å¯èƒ½æ˜¯æ—©æœŸé–‹ç™¼æ™‚çš„æ®˜ç•™

## ğŸ¯ å»ºè­°æ“ä½œ

### ğŸ§¹ æ¸…ç†å»ºè­°

#### ç«‹å³æ¸…ç†
1. **åˆªé™¤ `verify-student-code` ç›®éŒ„**
   ```bash
   rm -rf functions/verify-student-code/
   ```
   - åŸå› : æœªå¯¦ç¾ä¸”ç„¡å¯¦éš›ç”¨é€”

#### è€ƒæ…®ä¿ç•™
2. **`send-contact-email` å‡½æ•¸**
   - å¦‚æœè¨ˆåŠƒæ·»åŠ è¯ç¹«è¡¨å–®åŠŸèƒ½ï¼Œå¯ä»¥ä¿ç•™
   - å¦‚æœä¸éœ€è¦ï¼Œå»ºè­°åˆªé™¤
   - ä»£ç¢¼å·²å®Œæ•´å¯¦ç¾ï¼Œå¯éš¨æ™‚å•Ÿç”¨

### ğŸ“ é…ç½®æ›´æ–°

å¦‚æœæ±ºå®šå•Ÿç”¨ `send-contact-email`ï¼Œéœ€è¦ï¼š

1. **æ›´æ–° `appwrite.json`**
   ```json
   {
     "$id": "send-contact-email",
     "execute": ["any"],
     "name": "Send Contact Email",
     "enabled": true,
     "logging": true,
     "runtime": "node-18.0",
     "scopes": [],
     "events": [],
     "schedule": "",
     "timeout": 15,
     "entrypoint": "src/main.js",
     "commands": "npm install",
     "specification": "s-0.5vcpu-512mb",
     "path": "functions/send-contact-email"
   }
   ```

2. **éƒ¨ç½²å‡½æ•¸**
   ```bash
   appwrite deploy function
   ```

3. **æ·»åŠ å‰ç«¯èª¿ç”¨ä»£ç¢¼**

## ğŸ” Appwrite Console é¡¯ç¤ºåˆ†æ

### ç‚ºä»€éº¼åªçœ‹åˆ° 2 å€‹å‡½æ•¸ï¼Ÿ

æ ¹æ“šåˆ†æï¼ŒAppwrite Console åªé¡¯ç¤º 2 å€‹å‡½æ•¸æ˜¯æ­£ç¢ºçš„ï¼š

1. **`send-verification-email`** - å·²é…ç½®ä¸¦éƒ¨ç½²
2. **`cleanup-expired-codes`** - å·²é…ç½®ä¸¦éƒ¨ç½²

å¦å¤– 2 å€‹å‡½æ•¸ç›®éŒ„ï¼š
- **`send-contact-email`** - æœªåœ¨ `appwrite.json` ä¸­é…ç½®
- **`verify-student-code`** - æœªå¯¦ç¾ä¸”æœªé…ç½®

### ğŸ“Š å‡½æ•¸ç‹€æ…‹ç¸½çµ

| å‡½æ•¸åç¨± | æœ¬åœ°ç›®éŒ„ | appwrite.json | Console é¡¯ç¤º | å¯¦éš›ä½¿ç”¨ |
|:---|:---:|:---:|:---:|:---:|
| send-verification-email | âœ… | âœ… | âœ… | âœ… |
| cleanup-expired-codes | âœ… | âœ… | âœ… | âœ… |
| send-contact-email | âœ… | âŒ | âŒ | âŒ |
| verify-student-code | âœ… | âŒ | âŒ | âŒ |

## ğŸš€ å„ªåŒ–å»ºè­°

### 1. ç«‹å³åŸ·è¡Œ
- åˆªé™¤ `verify-student-code` ç›®éŒ„
- æ±ºå®šæ˜¯å¦ä¿ç•™ `send-contact-email`

### 2. åŠŸèƒ½è¦åŠƒ
å¦‚æœéœ€è¦è¯ç¹«è¡¨å–®åŠŸèƒ½ï¼š
- å®Œå–„ `send-contact-email` é…ç½®
- æ·»åŠ å‰ç«¯è¯ç¹«è¡¨å–®é é¢
- éƒ¨ç½²ä¸¦æ¸¬è©¦åŠŸèƒ½

### 3. æ–‡æª”æ›´æ–°
- æ›´æ–°é …ç›®æ–‡æª”ä¸­çš„å‡½æ•¸èªªæ˜
- è¨˜éŒ„å‡½æ•¸çš„ç”¨é€”å’Œèª¿ç”¨æ–¹å¼

## ğŸ“ æ¸…ç†è…³æœ¬

å‰µå»ºä¸€å€‹æ¸…ç†è…³æœ¬ä¾†ç§»é™¤æœªä½¿ç”¨çš„å‡½æ•¸ï¼š

```bash
#!/bin/bash
# æ¸…ç†æœªä½¿ç”¨çš„ Appwrite å‡½æ•¸

echo "ğŸ§¹ æ¸…ç†æœªä½¿ç”¨çš„ Appwrite å‡½æ•¸..."

# åˆªé™¤æœªå¯¦ç¾çš„å‡½æ•¸
if [ -d "functions/verify-student-code" ]; then
    echo "âŒ åˆªé™¤ verify-student-code (æœªå¯¦ç¾)"
    rm -rf functions/verify-student-code/
fi

# è©¢å•æ˜¯å¦åˆªé™¤ send-contact-email
if [ -d "functions/send-contact-email" ]; then
    read -p "â“ æ˜¯å¦åˆªé™¤ send-contact-email? (y/N): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "âŒ åˆªé™¤ send-contact-email"
        rm -rf functions/send-contact-email/
    else
        echo "âœ… ä¿ç•™ send-contact-email"
    fi
fi

echo "âœ… æ¸…ç†å®Œæˆï¼"
```

## ğŸ¯ çµè«–

**ç•¶å‰ç‹€æ³æ˜¯æ­£å¸¸çš„** - Appwrite Console åªé¡¯ç¤º 2 å€‹å‡½æ•¸æ˜¯æ­£ç¢ºçš„ï¼Œå› ç‚ºåªæœ‰é€™ 2 å€‹å‡½æ•¸è¢«æ­£ç¢ºé…ç½®å’Œéƒ¨ç½²ã€‚å…¶ä»– 2 å€‹å‡½æ•¸ç›®éŒ„æ˜¯æœªä½¿ç”¨æˆ–æœªå®Œæ•´å¯¦ç¾çš„ä»£ç¢¼ï¼Œå¯ä»¥å®‰å…¨åœ°æ¸…ç†ã€‚ 