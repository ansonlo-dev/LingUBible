# Appwrite ç”¨æˆ¶çµ±è¨ˆç³»çµ±è¨­ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

è¦å¯¦ç¾çœŸæ­£çš„å¤šç”¨æˆ¶åœ¨ç·šç‹€æ…‹è¿½è¹¤ï¼Œæ‚¨éœ€è¦åœ¨ Appwrite ä¸­è¨­ç½®ä»¥ä¸‹æ•¸æ“šåº«çµæ§‹ã€‚

## ğŸ—„ï¸ æ•¸æ“šåº«è¨­ç½®

### 1. å‰µå»ºæ•¸æ“šåº«

åœ¨ Appwrite æ§åˆ¶å°ä¸­ï¼š

1. é€²å…¥ **Databases** é é¢
2. é»æ“Š **Create Database**
3. è¨­ç½®æ•¸æ“šåº« IDï¼š`user-stats-db`
4. è¨­ç½®æ•¸æ“šåº«åç¨±ï¼š`User Statistics Database`

### 2. å‰µå»ºé›†åˆ

#### é›†åˆ 1ï¼šç”¨æˆ¶æœƒè©± (user-sessions)

**åŸºæœ¬è¨­ç½®ï¼š**
- Collection ID: `user-sessions`
- Collection Name: `User Sessions`
- Permissions: 
  - Read: `users`
  - Create: `users`
  - Update: `users`
  - Delete: `users`

**å±¬æ€§ (Attributes)ï¼š**

| å±¬æ€§å | é¡å‹ | å¤§å° | å¿…å¡« | é™£åˆ— | é è¨­å€¼ | èªªæ˜ |
|--------|------|------|------|------|--------|------|
| `userId` | String | 255 | âœ… | âŒ | - | ç”¨æˆ¶ ID |
| `sessionId` | String | 255 | âœ… | âŒ | - | æœƒè©± ID |
| `loginTime` | DateTime | - | âœ… | âŒ | - | ç™»å…¥æ™‚é–“ |
| `lastPing` | DateTime | - | âœ… | âŒ | - | æœ€å¾Œ ping æ™‚é–“ |
| `deviceInfo` | String | 1000 | âŒ | âŒ | - | è¨­å‚™ä¿¡æ¯ |
| `ipAddress` | String | 45 | âŒ | âŒ | - | IP åœ°å€ |

**ç´¢å¼• (Indexes)ï¼š**

| ç´¢å¼•å | é¡å‹ | å±¬æ€§ | æ’åº |
|--------|------|------|------|
| `userId_index` | Key | `userId` | ASC |
| `sessionId_index` | Key | `sessionId` | ASC |
| `lastPing_index` | Key | `lastPing` | DESC |

#### é›†åˆ 2ï¼šçµ±è¨ˆæ•¸æ“š (user-stats)

**åŸºæœ¬è¨­ç½®ï¼š**
- Collection ID: `user-stats`
- Collection Name: `User Statistics`
- Permissions:
  - Read: `users`
  - Create: `users`
  - Update: `users`
  - Delete: `users`

**å±¬æ€§ (Attributes)ï¼š**

| å±¬æ€§å | é¡å‹ | å¤§å° | å¿…å¡« | é™£åˆ— | é è¨­å€¼ | èªªæ˜ |
|--------|------|------|------|------|--------|------|
| `totalUsers` | Integer | - | âœ… | âŒ | 0 | ç¸½ç”¨æˆ¶æ•¸ |
| `todayLogins` | Integer | - | âœ… | âŒ | 0 | ä»Šæ—¥ç™»å…¥æ•¸ |
| `thisMonthLogins` | Integer | - | âœ… | âŒ | 0 | æœ¬æœˆç™»å…¥æ•¸ |
| `lastUpdated` | DateTime | - | âœ… | âŒ | - | æœ€å¾Œæ›´æ–°æ™‚é–“ |

#### é›†åˆ 3ï¼šå·²ç™»å…¥ç”¨æˆ¶ (logged-users)

**åŸºæœ¬è¨­ç½®ï¼š**
- Collection ID: `logged-users`
- Collection Name: `Logged Users`
- Permissions:
  - Read: `users`
  - Create: `users`
  - Update: `users`
  - Delete: `users`

**å±¬æ€§ (Attributes)ï¼š**

| å±¬æ€§å | é¡å‹ | å¤§å° | å¿…å¡« | é™£åˆ— | é è¨­å€¼ | èªªæ˜ |
|--------|------|------|------|------|--------|------|
| `userId` | String | 255 | âœ… | âŒ | - | ç”¨æˆ¶ ID |
| `firstLogin` | DateTime | - | âœ… | âŒ | - | é¦–æ¬¡ç™»å…¥æ™‚é–“ |

**ç´¢å¼• (Indexes)ï¼š**

| ç´¢å¼•å | é¡å‹ | å±¬æ€§ | æ’åº |
|--------|------|------|------|
| `userId_unique` | Unique | `userId` | ASC |

## ğŸ”§ ç’°å¢ƒè®Šæ•¸è¨­ç½®

ç¢ºä¿æ‚¨çš„ `.env` æ–‡ä»¶åŒ…å«æ­£ç¢ºçš„ Appwrite é…ç½®ï¼š

```env
VITE_APPWRITE_ENDPOINT=https://your-appwrite-endpoint
VITE_APPWRITE_PROJECT_ID=your-project-id
```

## ğŸš€ å•Ÿç”¨æ–°ç³»çµ±

### 1. æ›´æ–° useUserStats Hook

ä¿®æ”¹ `src/hooks/useUserStats.ts`ï¼š

```typescript
// æ›¿æ›å°å…¥
import AppwriteUserStatsService from "@/services/api/appwriteUserStats";

export function useUserStats() {
  // ä½¿ç”¨ Appwrite ç‰ˆæœ¬
  const userStatsService = AppwriteUserStatsService.getInstance();
  
  // å…¶ä»–ä»£ç¢¼ä¿æŒä¸è®Š...
}
```

### 2. æ›´æ–° App.tsx

ä¿®æ”¹ ping ç³»çµ±é…ç½®ï¼š

```typescript
// åœ¨ AppContent çµ„ä»¶ä¸­
usePingSystem({
  enabled: true,
  pingInterval: 60 * 1000, // æ¯ 60 ç§’ ping ä¸€æ¬¡
  activityEvents: ['click', 'keydown', 'scroll', 'mousemove', 'touchstart']
});
```

## ğŸ“Š å·¥ä½œåŸç†

### æ•¸æ“šæµç¨‹ï¼š

```
ç”¨æˆ¶ A ç™»å…¥ â†’ Appwrite æ•¸æ“šåº« â† ç”¨æˆ¶ B ç™»å…¥
     â†“                â†“                â†“
   Ping A         çµ±è¨ˆæœå‹™          Ping B
     â†“                â†“                â†“
æ‰€æœ‰ç”¨æˆ¶éƒ½èƒ½çœ‹åˆ° â†’ å¯¦æ™‚åœ¨ç·šæ•¸é‡ â† æ‰€æœ‰ç”¨æˆ¶éƒ½èƒ½çœ‹åˆ°
```

### Ping æ©Ÿåˆ¶ï¼š

1. **ç”¨æˆ¶ç™»å…¥**ï¼šåœ¨ `user-sessions` é›†åˆä¸­å‰µå»ºè¨˜éŒ„
2. **å®šæœŸ Ping**ï¼šæ¯ 60 ç§’æ›´æ–° `lastPing` æ™‚é–“
3. **æ¸…ç†éæœŸ**ï¼šåˆªé™¤ 2 åˆ†é˜ç„¡ ping çš„æœƒè©±
4. **çµ±è¨ˆè¨ˆç®—**ï¼šå¯¦æ™‚è¨ˆç®—åœ¨ç·šç”¨æˆ¶æ•¸

## ğŸ” æ¸¬è©¦é©—è­‰

### 1. å¤šè¨­å‚™æ¸¬è©¦

1. åœ¨ä¸åŒè¨­å‚™/ç€è¦½å™¨ä¸­æ‰“é–‹æ‡‰ç”¨
2. åˆ†åˆ¥ç™»å…¥ä¸åŒå¸³æˆ¶
3. æŸ¥çœ‹ Footer ä¸­çš„åœ¨ç·šç”¨æˆ¶æ•¸æ˜¯å¦æ­£ç¢ºå¢åŠ 

### 2. Ping æ¸¬è©¦

1. æ‰“é–‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·
2. æŸ¥çœ‹ Network æ¨™ç±¤
3. ç¢ºèªæ¯ 60 ç§’æœ‰ Appwrite API è«‹æ±‚

### 3. è¶…æ™‚æ¸¬è©¦

1. ç™»å…¥å¾Œé—œé–‰ç€è¦½å™¨
2. ç­‰å¾… 2 åˆ†é˜
3. åœ¨å…¶ä»–è¨­å‚™æŸ¥çœ‹åœ¨ç·šæ•¸é‡æ˜¯å¦æ¸›å°‘

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œï¼š

1. **æ¬Šé™éŒ¯èª¤**ï¼šç¢ºä¿é›†åˆæ¬Šé™è¨­ç½®æ­£ç¢º
2. **ç¶²è·¯éŒ¯èª¤**ï¼šæª¢æŸ¥ Appwrite ç«¯é»é…ç½®
3. **æ•¸æ“šä¸åŒæ­¥**ï¼šç¢ºèªç´¢å¼•è¨­ç½®æ­£ç¢º

### èª¿è©¦å·¥å…·ï¼š

ä½¿ç”¨ `/dev/test-ping-system.html` é é¢é€²è¡Œè©³ç´°æ¸¬è©¦å’Œèª¿è©¦ã€‚

## ğŸ“ˆ æ€§èƒ½å„ªåŒ–

### å»ºè­°ï¼š

1. **æ‰¹é‡æ¸…ç†**ï¼šå®šæœŸæ‰¹é‡åˆªé™¤éæœŸæœƒè©±
2. **ç´¢å¼•å„ªåŒ–**ï¼šç¢ºä¿æŸ¥è©¢ä½¿ç”¨æ­£ç¢ºçš„ç´¢å¼•
3. **ç·©å­˜ç­–ç•¥**ï¼šè€ƒæ…®åœ¨å‰ç«¯ç·©å­˜çµ±è¨ˆæ•¸æ“š

### ç›£æ§ï¼š

åœ¨ Appwrite æ§åˆ¶å°ç›£æ§ï¼š
- æ•¸æ“šåº«ä½¿ç”¨é‡
- API è«‹æ±‚é »ç‡
- éŒ¯èª¤æ—¥èªŒ

## ğŸ¯ å®Œæˆå¾Œçš„æ•ˆæœ

âœ… **çœŸæ­£çš„å¤šç”¨æˆ¶åœ¨ç·šç‹€æ…‹è¿½è¹¤**
âœ… **è·¨è¨­å‚™åŒæ­¥**
âœ… **å¯¦æ™‚æ›´æ–°**
âœ… **æº–ç¢ºçš„çµ±è¨ˆæ•¸æ“š**
âœ… **è‡ªå‹•æ¸…ç†éæœŸæœƒè©±**

ç¾åœ¨æ‚¨çš„æ‡‰ç”¨å°‡èƒ½å¤ æº–ç¢ºé¡¯ç¤ºæ‰€æœ‰ç”¨æˆ¶çš„åœ¨ç·šç‹€æ…‹ï¼ 