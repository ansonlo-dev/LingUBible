# æ¡Œé¢ PWA å®‰è£æŒ‰éˆ•ä¿®å¾©ç¸½çµ

## å•é¡Œæè¿°
åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œæ¡Œé¢ç€è¦½å™¨ï¼ˆChromeã€Edgeï¼‰çš„ PWA å®‰è£æŒ‰éˆ•ï¼ˆåœ°å€æ¬„å’Œé ‚éƒ¨æ¬„ï¼‰æ¶ˆå¤±ï¼Œä½†åœ¨ localhost é–‹ç™¼ç’°å¢ƒä¸­æ­£å¸¸é¡¯ç¤ºã€‚æ‰‹æ©Ÿç«¯åœ¨å…©ç¨®ç’°å¢ƒä¸­éƒ½æ­£å¸¸å·¥ä½œã€‚

## æ ¹æœ¬åŸå› åˆ†æ
1. **Service Worker è·¯å¾‘ä¸ä¸€è‡´**ï¼šé–‹ç™¼ç’°å¢ƒå’Œç”Ÿç”¢ç’°å¢ƒä½¿ç”¨ä¸åŒçš„ SW æ–‡ä»¶è·¯å¾‘
2. **Manifest é…ç½®å•é¡Œ**ï¼šç”Ÿç”¢ç’°å¢ƒçš„ manifest é…ç½®ä¸å®Œæ•´
3. **åœ–æ¨™æ–‡ä»¶ç¼ºå¤±**ï¼šæŸäº›å¿…éœ€çš„åœ–æ¨™æ–‡ä»¶åœ¨ç”Ÿç”¢æ§‹å»ºä¸­è¢«å¿½ç•¥
4. **PWA å®‰è£æ¢ä»¶ä¸æ»¿è¶³**ï¼šç¼ºå°‘å¿…è¦çš„ PWA å®‰è£æ¢ä»¶æª¢æŸ¥

## ä¿®å¾©å…§å®¹

### 1. æ›´æ–° Vite PWA é…ç½® (`vite.config.ts`)

#### ä¸»è¦æ”¹é€²ï¼š
- âœ… ç¢ºä¿ç”Ÿç”¢ç’°å¢ƒåŒ…å«æ‰€æœ‰å¿…è¦çš„åœ–æ¨™æ–‡ä»¶
- âœ… æ·»åŠ  manifest ç·©å­˜ç­–ç•¥
- âœ… å„ªåŒ– Service Worker é…ç½®
- âœ… æ·»åŠ æˆªåœ–å’Œå¿«æ·æ–¹å¼ä»¥æé«˜å®‰è£æç¤ºé¡¯ç¤ºæ©Ÿç‡
- âœ… è¨­ç½®æ­£ç¢ºçš„ navigateFallback é…ç½®

```typescript
// ç”Ÿç”¢ç’°å¢ƒåŒ…å«æ‰€æœ‰å¿…è¦çš„åœ–æ¨™æ–‡ä»¶
...(mode === 'production' ? [
  '*.{ico,png,svg}',
  'assets/**/*.{png,svg,jpg,jpeg,gif,webp}',
  'android/*.png',
  'ios/*.png'
] : [])

// æ·»åŠ  manifest æ–‡ä»¶ç·©å­˜
{
  urlPattern: /\/manifest.*\.json$/,
  handler: 'StaleWhileRevalidate' as const,
  options: {
    cacheName: 'manifest-cache',
    expiration: {
      maxEntries: 5,
      maxAgeSeconds: 60 * 60 * 24 // 1 day
    }
  }
}
```

### 2. å¢å¼· Service Worker è¨»å†Šè…³æœ¬ (`public/sw-register.js`)

#### æ–°å¢åŠŸèƒ½ï¼š
- âœ… æ™ºèƒ½ç’°å¢ƒæª¢æ¸¬ï¼ˆé–‹ç™¼/ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨ä¸åŒ SW æ–‡ä»¶ï¼‰
- âœ… å¢å¼·çš„å®‰è£æç¤ºè™•ç†
- âœ… å¤šç€è¦½å™¨æ‰‹å‹•å®‰è£æŒ‡å¼•
- âœ… è©³ç´°çš„è¨ºæ–·æ—¥èªŒ
- âœ… è‡ªå®šç¾©äº‹ä»¶ç³»çµ±
- âœ… å®šæœŸ SW æ›´æ–°æª¢æŸ¥ï¼ˆåƒ…ç”Ÿç”¢ç’°å¢ƒï¼‰

```javascript
// ç’°å¢ƒæª¢æ¸¬
const swPath = window.location.hostname === 'localhost' || 
               window.location.hostname === '127.0.0.1' || 
               window.location.hostname.includes('localhost') 
               ? '/dev-sw.js' 
               : '/sw.js';

// å¢å¼·çš„å®‰è£æç¤ºè™•ç†
window.addEventListener('beforeinstallprompt', function(e) {
  console.log('ğŸ’¡ PWA å®‰è£æç¤ºå¯ç”¨');
  console.log('ğŸ–¥ï¸ å¹³å°:', e.platforms);
  
  e.preventDefault();
  deferredPrompt = e;
  
  // è§¸ç™¼è‡ªå®šç¾©äº‹ä»¶
  window.dispatchEvent(new CustomEvent('pwaInstallAvailable', {
    detail: { platforms: e.platforms, canInstall: true }
  }));
});
```

### 3. å„ªåŒ–å‹•æ…‹ Manifest è™•ç† (`index.html`)

#### æ”¹é€²ï¼š
- âœ… æ·»åŠ æ™‚é–“æˆ³ç¢ºä¿ manifest æ›´æ–°
- âœ… è§¸ç™¼ manifest æ›´æ–°äº‹ä»¶
- âœ… å®šæœŸæª¢æŸ¥ manifest æ›´æ–°ï¼ˆåƒ…ç”Ÿç”¢ç’°å¢ƒï¼‰
- âœ… æ›´å¥½çš„éŒ¯èª¤è™•ç†

```javascript
// æ ¹æ“šç”¨æˆ¶èªè¨€è¨­ç½®å‹•æ…‹ manifestï¼Œæ·»åŠ æ™‚é–“æˆ³ç¢ºä¿æ›´æ–°
const timestamp = Date.now();
manifestLink.href = `/manifest-dynamic.json?lang=${userLanguage}&v=${timestamp}`;

// è§¸ç™¼ manifest æ›´æ–°äº‹ä»¶
window.dispatchEvent(new CustomEvent('manifestUpdated', {
  detail: { language: userLanguage, timestamp }
}));
```

### 4. å‰µå»ºè¨ºæ–·å·¥å…·

#### æ–°å¢æ–‡ä»¶ï¼š
- âœ… `public/pwa-desktop-debug.html` - æ¡Œé¢ PWA è¨ºæ–·é é¢
- âœ… `scripts/test-pwa-desktop.js` - PWA é…ç½®æª¢æŸ¥è…³æœ¬
- âœ… `bun run pwa:test-desktop` - æ–°çš„æ¸¬è©¦å‘½ä»¤

## æ¸¬è©¦å’Œé©—è­‰

### 1. é‹è¡Œé…ç½®æª¢æŸ¥
```bash
bun run pwa:test-desktop
```

### 2. è¨ªå•è¨ºæ–·é é¢
- é–‹ç™¼ç’°å¢ƒ: `http://localhost:8080/pwa-desktop-debug.html`
- ç”Ÿç”¢ç’°å¢ƒ: `https://your-domain.com/pwa-desktop-debug.html`

### 3. æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°
æŸ¥çœ‹æ˜¯å¦æœ‰ä»¥ä¸‹æ—¥èªŒï¼š
- `âœ… Service Worker è¨»å†ŠæˆåŠŸ`
- `ğŸ’¡ PWA å®‰è£æç¤ºå¯ç”¨`
- `ğŸŒ PWA Manifest å·²æ›´æ–°ç‚ºèªè¨€`

## æ”¯æ´çš„ç€è¦½å™¨

### å®Œå…¨æ”¯æ´ï¼ˆæ¨è–¦ï¼‰
- âœ… Chrome 67+
- âœ… Edge 79+

### æœ‰é™æ”¯æ´
- âš ï¸ Firefox 58+ ï¼ˆPWA å®‰è£æ”¯æ´æœ‰é™ï¼‰
- âš ï¸ Safari 11.1+ ï¼ˆåƒ… iOSï¼Œæ¡Œé¢ç‰ˆæ”¯æ´æœ‰é™ï¼‰

## æ•…éšœæ’é™¤

### å¦‚æœå®‰è£æŒ‰éˆ•ä»æœªé¡¯ç¤ºï¼š

1. **æª¢æŸ¥ HTTPS**
   - ç¢ºä¿ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨ HTTPS
   - localhost é–‹ç™¼ç’°å¢ƒå¯ä»¥ä½¿ç”¨ HTTP

2. **æ¸…é™¤ç·©å­˜**
   ```
   1. æ‰“é–‹é–‹ç™¼è€…å·¥å…· (F12)
   2. Application â†’ Storage â†’ Clear storage
   3. é‡æ–°è¼‰å…¥é é¢
   ```

3. **æª¢æŸ¥ Service Worker**
   ```
   1. é–‹ç™¼è€…å·¥å…· â†’ Application â†’ Service Workers
   2. ç¢ºèª SW ç‹€æ…‹ç‚º "activated and running"
   3. å¦‚æœ‰å•é¡Œï¼Œé»æ“Š "Unregister" å¾Œé‡æ–°è¼‰å…¥
   ```

4. **é©—è­‰ Manifest**
   ```
   1. é–‹ç™¼è€…å·¥å…· â†’ Application â†’ Manifest
   2. æª¢æŸ¥æ˜¯å¦æœ‰éŒ¯èª¤æˆ–è­¦å‘Š
   3. ç¢ºèªåœ–æ¨™æ–‡ä»¶å¯ä»¥æ­£å¸¸è¼‰å…¥
   ```

5. **ä½¿ç”¨ç„¡ç—•æ¨¡å¼æ¸¬è©¦**
   - åœ¨ç„¡ç—•è¦–çª—ä¸­æ¸¬è©¦ï¼Œæ’é™¤æ“´å±•ç¨‹å¼å¹²æ“¾

6. **æª¢æŸ¥ç€è¦½å™¨ç‰ˆæœ¬**
   - ç¢ºä¿ä½¿ç”¨æ”¯æ´ PWA çš„ç€è¦½å™¨ç‰ˆæœ¬

## é æœŸçµæœ

ä¿®å¾©å¾Œï¼Œæ‚¨æ‡‰è©²çœ‹åˆ°ï¼š

### æ¡Œé¢ç€è¦½å™¨ (Chrome/Edge)
- âœ… åœ°å€æ¬„å³å´å‡ºç¾å®‰è£åœ–æ¨™ âŠ•
- âœ… ç€è¦½å™¨èœå–®ä¸­æœ‰ã€Œå®‰è£æ‡‰ç”¨ç¨‹å¼ã€é¸é …
- âœ… æ§åˆ¶å°é¡¯ç¤º `ğŸ’¡ PWA å®‰è£æç¤ºå¯ç”¨`

### æ‰‹æ©Ÿç€è¦½å™¨
- âœ… ç¹¼çºŒæ­£å¸¸å·¥ä½œï¼ˆç„¡è®ŠåŒ–ï¼‰
- âœ… å®‰è£æ©«å¹…æˆ–åº•éƒ¨æç¤º

### æ‰€æœ‰å¹³å°
- âœ… Service Worker æ­£ç¢ºè¨»å†Š
- âœ… Manifest æ–‡ä»¶æ­£å¸¸è¼‰å…¥
- âœ… æ‰€æœ‰åœ–æ¨™æ–‡ä»¶å¯è¨ªå•

## éƒ¨ç½²æ³¨æ„äº‹é …

1. **æ§‹å»ºå‰æª¢æŸ¥**
   ```bash
   bun run pwa:test-desktop
   ```

2. **æ§‹å»ºå’Œéƒ¨ç½²**
   ```bash
   bun run build
   bun run deploy
   ```

3. **éƒ¨ç½²å¾Œé©—è­‰**
   - è¨ªå•ç”Ÿç”¢ç’°å¢ƒè¨ºæ–·é é¢
   - æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°
   - æ¸¬è©¦ PWA å®‰è£æµç¨‹

## ç¸½çµ

é€™æ¬¡ä¿®å¾©è§£æ±ºäº†æ¡Œé¢ç€è¦½å™¨ PWA å®‰è£æŒ‰éˆ•åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­æ¶ˆå¤±çš„å•é¡Œã€‚ä¸»è¦é€šéï¼š

1. **å®Œå–„ PWA é…ç½®** - ç¢ºä¿æ‰€æœ‰å¿…è¦æ–‡ä»¶åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­å¯ç”¨
2. **å¢å¼·ç’°å¢ƒæª¢æ¸¬** - é–‹ç™¼å’Œç”Ÿç”¢ç’°å¢ƒä½¿ç”¨æ­£ç¢ºçš„ Service Worker
3. **æ”¹é€²éŒ¯èª¤è™•ç†** - æä¾›è©³ç´°çš„è¨ºæ–·ä¿¡æ¯å’Œæ‰‹å‹•å®‰è£æŒ‡å¼•
4. **æ·»åŠ è¨ºæ–·å·¥å…·** - æ–¹ä¾¿é–‹ç™¼è€…å¿«é€Ÿå®šä½å•é¡Œ

ç¾åœ¨æ‚¨çš„ PWA æ‡‰è©²åœ¨æ‰€æœ‰æ”¯æ´çš„æ¡Œé¢ç€è¦½å™¨ä¸­æ­£ç¢ºé¡¯ç¤ºå®‰è£æŒ‰éˆ•äº†ï¼ 