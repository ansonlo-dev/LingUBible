<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ éƒ¨ç½²ä¿®å¾©æ¸¬è©¦ - LingUBible</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .test-section h2 {
            margin-top: 0;
            color: #fff;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .status.success {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4CAF50;
        }
        .status.warning {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid #FFC107;
        }
        .status.error {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid #F44336;
        }
        .status.info {
            background: rgba(33, 150, 243, 0.3);
            border: 1px solid #2196F3;
        }
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        .pwa-install-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }
        .log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .metric {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 10px 0;
        }
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
        }
        .metric-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }
        .version-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .version-info h3 {
            margin-top: 0;
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ éƒ¨ç½²ä¿®å¾©æ¸¬è©¦å·¥å…·</h1>
        <p style="text-align: center; opacity: 0.9;">æ¸¬è©¦ç‰ˆæœ¬æª¢æ¸¬ã€ç·©å­˜æ¸…ç†å’Œ PWA å®‰è£åŠŸèƒ½</p>

        <div class="test-grid">
            <!-- ç‰ˆæœ¬æª¢æ¸¬æ¸¬è©¦ -->
            <div class="test-section">
                <h2>ğŸ“¦ ç‰ˆæœ¬æª¢æ¸¬æ¸¬è©¦</h2>
                <div id="version-status"></div>
                <button onclick="testVersionDetection()">æª¢æ¸¬ç‰ˆæœ¬</button>
                <button onclick="simulateVersionUpdate()">æ¨¡æ“¬ç‰ˆæœ¬æ›´æ–°</button>
                <button onclick="clearVersionData()">æ¸…é™¤ç‰ˆæœ¬æ•¸æ“š</button>
                <div class="version-info">
                    <h3>ç‰ˆæœ¬ä¿¡æ¯</h3>
                    <div id="version-details"></div>
                </div>
            </div>

            <!-- ç·©å­˜æ¸¬è©¦ -->
            <div class="test-section">
                <h2>ğŸ—„ï¸ ç·©å­˜ç®¡ç†æ¸¬è©¦</h2>
                <div id="cache-status"></div>
                <button onclick="testCacheStatus()">æª¢æŸ¥ç·©å­˜</button>
                <button onclick="forceClearCache()">å¼·åˆ¶æ¸…ç†ç·©å­˜</button>
                <button onclick="testCacheClearing()">æ¸¬è©¦ç·©å­˜æ¸…ç†</button>
                <div id="cache-details"></div>
            </div>

            <!-- PWA å®‰è£æ¸¬è©¦ -->
            <div class="test-section">
                <h2>ğŸ“± PWA å®‰è£æ¸¬è©¦</h2>
                <div id="pwa-status"></div>
                <button onclick="testPWAInstall()" class="pwa-install-button">æ¸¬è©¦ PWA å®‰è£</button>
                <button onclick="checkPWAStatus()">æª¢æŸ¥ PWA ç‹€æ…‹</button>
                <button onclick="simulateUserInteraction()">æ¨¡æ“¬ç”¨æˆ¶äº’å‹•</button>
                <div id="pwa-details"></div>
            </div>

            <!-- Service Worker æ¸¬è©¦ -->
            <div class="test-section">
                <h2>âš™ï¸ Service Worker æ¸¬è©¦</h2>
                <div id="sw-status"></div>
                <button onclick="testServiceWorker()">æª¢æŸ¥ SW</button>
                <button onclick="updateServiceWorker()">æ›´æ–° SW</button>
                <button onclick="unregisterServiceWorker()">è¨»éŠ· SW</button>
                <div id="sw-details"></div>
            </div>
        </div>

        <!-- å¯¦æ™‚æ—¥èªŒ -->
        <div class="test-section">
            <h2>ğŸ“‹ å¯¦æ™‚æ—¥èªŒ</h2>
            <button onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
            <button onclick="exportLog()">å°å‡ºæ—¥èªŒ</button>
            <div id="log" class="log"></div>
        </div>

        <!-- ç³»çµ±ä¿¡æ¯ -->
        <div class="test-section">
            <h2>ğŸ’» ç³»çµ±ä¿¡æ¯</h2>
            <div id="system-info"></div>
            <button onclick="refreshSystemInfo()">åˆ·æ–°ä¿¡æ¯</button>
        </div>
    </div>

    <script>
        let logEntries = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            logEntries.push(entry);
            
            const logElement = document.getElementById('log');
            logElement.textContent = logEntries.slice(-50).join('\n');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(message);
        }

        function clearLog() {
            logEntries = [];
            document.getElementById('log').textContent = '';
        }

        function exportLog() {
            const logText = logEntries.join('\n');
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lingubible-test-log-${new Date().toISOString().slice(0, 19)}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ç‰ˆæœ¬æª¢æ¸¬æ¸¬è©¦
        function testVersionDetection() {
            log('ğŸ” é–‹å§‹ç‰ˆæœ¬æª¢æ¸¬æ¸¬è©¦...');
            
            const currentVersion = localStorage.getItem('app_version');
            const cacheCleared = localStorage.getItem('cache_cleared_for_version');
            const swVersion = window.PWAInstaller?.getVersion();
            
            const status = document.getElementById('version-status');
            const details = document.getElementById('version-details');
            
            let html = '';
            if (currentVersion) {
                html += `<div class="status success">âœ… ç•¶å‰ç‰ˆæœ¬: ${currentVersion}</div>`;
            } else {
                html += `<div class="status warning">âš ï¸ æœªæ‰¾åˆ°ç‰ˆæœ¬ä¿¡æ¯</div>`;
            }
            
            if (cacheCleared) {
                html += `<div class="status info">ğŸ§¹ ç·©å­˜æ¸…ç†ç‰ˆæœ¬: ${cacheCleared}</div>`;
            }
            
            if (swVersion) {
                html += `<div class="status info">âš™ï¸ Service Worker ç‰ˆæœ¬: ${swVersion}</div>`;
            }
            
            status.innerHTML = html;
            
            details.innerHTML = `
                <p><strong>localStorage ç‰ˆæœ¬:</strong> ${currentVersion || 'æœªè¨­ç½®'}</p>
                <p><strong>ç·©å­˜æ¸…ç†æ¨™è¨˜:</strong> ${cacheCleared || 'æœªè¨­ç½®'}</p>
                <p><strong>SW ç‰ˆæœ¬:</strong> ${swVersion || 'æœªçŸ¥'}</p>
                <p><strong>ç‰ˆæœ¬ä¸€è‡´æ€§:</strong> ${currentVersion === swVersion ? 'âœ… ä¸€è‡´' : 'âŒ ä¸ä¸€è‡´'}</p>
            `;
            
            log(`ç‰ˆæœ¬æª¢æ¸¬å®Œæˆ: localStorage=${currentVersion}, SW=${swVersion}`);
        }

        function simulateVersionUpdate() {
            log('ğŸ”„ æ¨¡æ“¬ç‰ˆæœ¬æ›´æ–°...');
            
            // è¨­ç½®ä¸€å€‹èˆŠç‰ˆæœ¬
            const oldVersion = '0.1.16';
            localStorage.setItem('app_version', oldVersion);
            localStorage.removeItem('cache_cleared_for_version');
            
            log(`è¨­ç½®èˆŠç‰ˆæœ¬: ${oldVersion}`);
            
            // é‡æ–°è¼‰å…¥é é¢è§¸ç™¼ç‰ˆæœ¬æª¢æ¸¬
            setTimeout(() => {
                log('é‡æ–°è¼‰å…¥é é¢ä»¥è§¸ç™¼ç‰ˆæœ¬æª¢æ¸¬...');
                window.location.reload();
            }, 1000);
        }

        function clearVersionData() {
            log('ğŸ—‘ï¸ æ¸…é™¤ç‰ˆæœ¬æ•¸æ“š...');
            
            localStorage.removeItem('app_version');
            localStorage.removeItem('cache_cleared_for_version');
            
            log('ç‰ˆæœ¬æ•¸æ“šå·²æ¸…é™¤');
            testVersionDetection();
        }

        // ç·©å­˜æ¸¬è©¦
        async function testCacheStatus() {
            log('ğŸ—„ï¸ æª¢æŸ¥ç·©å­˜ç‹€æ…‹...');
            
            const status = document.getElementById('cache-status');
            const details = document.getElementById('cache-details');
            
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    
                    let html = `<div class="status success">âœ… æ‰¾åˆ° ${cacheNames.length} å€‹ç·©å­˜</div>`;
                    status.innerHTML = html;
                    
                    let detailsHtml = '<h4>ç·©å­˜è©³æƒ…:</h4>';
                    for (const cacheName of cacheNames) {
                        const cache = await caches.open(cacheName);
                        const keys = await cache.keys();
                        detailsHtml += `<p><strong>${cacheName}:</strong> ${keys.length} å€‹é …ç›®</p>`;
                    }
                    details.innerHTML = detailsHtml;
                    
                    log(`æ‰¾åˆ° ${cacheNames.length} å€‹ç·©å­˜: ${cacheNames.join(', ')}`);
                } catch (error) {
                    status.innerHTML = `<div class="status error">âŒ ç·©å­˜æª¢æŸ¥å¤±æ•—: ${error.message}</div>`;
                    log(`ç·©å­˜æª¢æŸ¥å¤±æ•—: ${error.message}`);
                }
            } else {
                status.innerHTML = `<div class="status warning">âš ï¸ ç€è¦½å™¨ä¸æ”¯æ´ Cache API</div>`;
                log('ç€è¦½å™¨ä¸æ”¯æ´ Cache API');
            }
        }

        async function forceClearCache() {
            log('ğŸ§¹ å¼·åˆ¶æ¸…ç†æ‰€æœ‰ç·©å­˜...');
            
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    await Promise.all(cacheNames.map(name => caches.delete(name)));
                    
                    log(`å·²æ¸…ç† ${cacheNames.length} å€‹ç·©å­˜`);
                    testCacheStatus();
                } catch (error) {
                    log(`æ¸…ç†ç·©å­˜å¤±æ•—: ${error.message}`);
                }
            } else {
                log('ç€è¦½å™¨ä¸æ”¯æ´ Cache API');
            }
        }

        function testCacheClearing() {
            log('ğŸ§ª æ¸¬è©¦ç·©å­˜æ¸…ç†é‚è¼¯...');
            
            // æ¨¡æ“¬ç‰ˆæœ¬æ›´æ–°è§¸ç™¼ç·©å­˜æ¸…ç†
            const currentVersion = localStorage.getItem('app_version');
            if (currentVersion) {
                localStorage.setItem('app_version', '0.1.16'); // è¨­ç½®èˆŠç‰ˆæœ¬
                localStorage.removeItem('cache_cleared_for_version');
                
                log('å·²è¨­ç½®èˆŠç‰ˆæœ¬ï¼Œé‡æ–°è¼‰å…¥é é¢å°‡è§¸ç™¼ç·©å­˜æ¸…ç†');
                
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } else {
                log('æœªæ‰¾åˆ°ç•¶å‰ç‰ˆæœ¬ï¼Œç„¡æ³•æ¸¬è©¦');
            }
        }

        // PWA å®‰è£æ¸¬è©¦
        function testPWAInstall() {
            log('ğŸ“± æ¸¬è©¦ PWA å®‰è£åŠŸèƒ½...');
            
            const status = document.getElementById('pwa-status');
            const details = document.getElementById('pwa-details');
            
            // æª¢æŸ¥ PWA å®‰è£ç‹€æ…‹
            const isPWAMode = window.matchMedia('(display-mode: standalone)').matches ||
                             window.navigator.standalone === true;
            
            const hasPrompt = window.PWAInstaller?.hasPrompt();
            const hasEngagement = window.PWAInstaller?.hasUserEngagement();
            
            let html = '';
            if (isPWAMode) {
                html += `<div class="status success">âœ… å·²åœ¨ PWA æ¨¡å¼ä¸‹é‹è¡Œ</div>`;
            } else if (hasPrompt) {
                html += `<div class="status success">âœ… PWA å®‰è£æç¤ºå¯ç”¨</div>`;
            } else {
                html += `<div class="status warning">âš ï¸ PWA å®‰è£æç¤ºä¸å¯ç”¨</div>`;
            }
            
            status.innerHTML = html;
            
            details.innerHTML = `
                <p><strong>PWA æ¨¡å¼:</strong> ${isPWAMode ? 'âœ… æ˜¯' : 'âŒ å¦'}</p>
                <p><strong>å®‰è£æç¤º:</strong> ${hasPrompt ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨'}</p>
                <p><strong>ç”¨æˆ¶äº’å‹•:</strong> ${hasEngagement ? 'âœ… å……è¶³' : 'âŒ ä¸è¶³'}</p>
                <p><strong>ç€è¦½å™¨:</strong> ${navigator.userAgent.split(' ').pop()}</p>
            `;
            
            // å˜—è©¦è§¸ç™¼å®‰è£
            if (hasPrompt && !isPWAMode) {
                log('å˜—è©¦è§¸ç™¼ PWA å®‰è£æç¤º...');
                window.PWAInstaller?.triggerInstallPrompt();
            } else if (isPWAMode) {
                log('æ‡‰ç”¨å·²åœ¨ PWA æ¨¡å¼ä¸‹é‹è¡Œ');
            } else {
                log('PWA å®‰è£æç¤ºä¸å¯ç”¨ï¼Œé¡¯ç¤ºæ‰‹å‹•å®‰è£æŒ‡å¼•');
                window.PWAInstaller?.showManualInstructions();
            }
        }

        function checkPWAStatus() {
            log('ğŸ” æª¢æŸ¥ PWA ç‹€æ…‹...');
            
            const status = document.getElementById('pwa-status');
            const details = document.getElementById('pwa-details');
            
            const isPWAMode = window.PWAInstaller?.isPWAMode();
            const hasPrompt = window.PWAInstaller?.hasPrompt();
            const hasEngagement = window.PWAInstaller?.hasUserEngagement();
            
            let html = `<div class="status info">ğŸ“Š PWA ç‹€æ…‹æª¢æŸ¥å®Œæˆ</div>`;
            status.innerHTML = html;
            
            details.innerHTML = `
                <h4>PWA ç‹€æ…‹è©³æƒ…:</h4>
                <p><strong>PWA æ¨¡å¼:</strong> ${isPWAMode}</p>
                <p><strong>å®‰è£æç¤º:</strong> ${hasPrompt}</p>
                <p><strong>ç”¨æˆ¶äº’å‹•:</strong> ${hasEngagement}</p>
                <p><strong>é¡¯ç¤ºæ¨¡å¼:</strong> ${window.matchMedia('(display-mode: standalone)').matches ? 'standalone' : 'browser'}</p>
                <p><strong>å¹³å°:</strong> ${navigator.platform}</p>
                <p><strong>ç”¨æˆ¶ä»£ç†:</strong> ${navigator.userAgent}</p>
            `;
            
            log(`PWA ç‹€æ…‹: æ¨¡å¼=${isPWAMode}, æç¤º=${hasPrompt}, äº’å‹•=${hasEngagement}`);
        }

        function simulateUserInteraction() {
            log('ğŸ‘¤ æ¨¡æ“¬ç”¨æˆ¶äº’å‹•...');
            
            // è§¸ç™¼é»æ“Šäº‹ä»¶
            document.body.click();
            
            // è§¸ç™¼æ»¾å‹•äº‹ä»¶
            window.scrollBy(0, 1);
            
            // è§¸ç™¼éµç›¤äº‹ä»¶
            const keyEvent = new KeyboardEvent('keydown', { key: 'Space' });
            document.dispatchEvent(keyEvent);
            
            log('å·²æ¨¡æ“¬ç”¨æˆ¶äº’å‹•ï¼ˆé»æ“Šã€æ»¾å‹•ã€éµç›¤ï¼‰');
            
            setTimeout(() => {
                checkPWAStatus();
            }, 1000);
        }

        // Service Worker æ¸¬è©¦
        async function testServiceWorker() {
            log('âš™ï¸ æª¢æŸ¥ Service Worker ç‹€æ…‹...');
            
            const status = document.getElementById('sw-status');
            const details = document.getElementById('sw-details');
            
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    
                    if (registration) {
                        const sw = registration.active || registration.installing || registration.waiting;
                        
                        let html = `<div class="status success">âœ… Service Worker å·²è¨»å†Š</div>`;
                        status.innerHTML = html;
                        
                        details.innerHTML = `
                            <h4>Service Worker è©³æƒ…:</h4>
                            <p><strong>ç‹€æ…‹:</strong> ${sw?.state || 'æœªçŸ¥'}</p>
                            <p><strong>è…³æœ¬ URL:</strong> ${sw?.scriptURL || 'æœªçŸ¥'}</p>
                            <p><strong>ç¯„åœ:</strong> ${registration.scope}</p>
                            <p><strong>æ›´æ–°æ™‚é–“:</strong> ${registration.updateViaCache}</p>
                        `;
                        
                        log(`Service Worker å·²è¨»å†Š: ${sw?.state}`);
                    } else {
                        status.innerHTML = `<div class="status warning">âš ï¸ Service Worker æœªè¨»å†Š</div>`;
                        log('Service Worker æœªè¨»å†Š');
                    }
                } catch (error) {
                    status.innerHTML = `<div class="status error">âŒ Service Worker æª¢æŸ¥å¤±æ•—: ${error.message}</div>`;
                    log(`Service Worker æª¢æŸ¥å¤±æ•—: ${error.message}`);
                }
            } else {
                status.innerHTML = `<div class="status error">âŒ ç€è¦½å™¨ä¸æ”¯æ´ Service Worker</div>`;
                log('ç€è¦½å™¨ä¸æ”¯æ´ Service Worker');
            }
        }

        async function updateServiceWorker() {
            log('ğŸ”„ æ›´æ–° Service Worker...');
            
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        await registration.update();
                        log('Service Worker æ›´æ–°è«‹æ±‚å·²ç™¼é€');
                    } else {
                        log('æœªæ‰¾åˆ° Service Worker è¨»å†Š');
                    }
                } catch (error) {
                    log(`Service Worker æ›´æ–°å¤±æ•—: ${error.message}`);
                }
            }
        }

        async function unregisterServiceWorker() {
            log('ğŸ—‘ï¸ è¨»éŠ· Service Worker...');
            
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        await registration.unregister();
                        log('Service Worker å·²è¨»éŠ·');
                        testServiceWorker();
                    } else {
                        log('æœªæ‰¾åˆ° Service Worker è¨»å†Š');
                    }
                } catch (error) {
                    log(`Service Worker è¨»éŠ·å¤±æ•—: ${error.message}`);
                }
            }
        }

        // ç³»çµ±ä¿¡æ¯
        function refreshSystemInfo() {
            log('ğŸ’» åˆ·æ–°ç³»çµ±ä¿¡æ¯...');
            
            const info = document.getElementById('system-info');
            
            info.innerHTML = `
                <div class="metric">
                    <div class="metric-value">${navigator.userAgent.includes('Chrome') ? 'Chrome' : 
                                                navigator.userAgent.includes('Firefox') ? 'Firefox' : 
                                                navigator.userAgent.includes('Safari') ? 'Safari' : 'å…¶ä»–'}</div>
                    <div class="metric-label">ç€è¦½å™¨</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${window.location.protocol}</div>
                    <div class="metric-label">å”è­°</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${navigator.onLine ? 'åœ¨ç·š' : 'é›¢ç·š'}</div>
                    <div class="metric-label">ç¶²çµ¡ç‹€æ…‹</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${window.innerWidth}x${window.innerHeight}</div>
                    <div class="metric-label">è¦–çª—å¤§å°</div>
                </div>
                <p><strong>ç”¨æˆ¶ä»£ç†:</strong> ${navigator.userAgent}</p>
                <p><strong>èªè¨€:</strong> ${navigator.language}</p>
                <p><strong>å¹³å°:</strong> ${navigator.platform}</p>
                <p><strong>Cookie å•Ÿç”¨:</strong> ${navigator.cookieEnabled ? 'æ˜¯' : 'å¦'}</p>
                <p><strong>æœ¬åœ°å­˜å„²:</strong> ${typeof(Storage) !== "undefined" ? 'æ”¯æ´' : 'ä¸æ”¯æ´'}</p>
            `;
            
            log('ç³»çµ±ä¿¡æ¯å·²åˆ·æ–°');
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.addEventListener('load', function() {
            log('ğŸš€ éƒ¨ç½²ä¿®å¾©æ¸¬è©¦å·¥å…·å·²è¼‰å…¥');
            
            // åˆå§‹åŒ–æ‰€æœ‰æ¸¬è©¦
            testVersionDetection();
            testCacheStatus();
            checkPWAStatus();
            testServiceWorker();
            refreshSystemInfo();
            
            log('æ‰€æœ‰åˆå§‹æ¸¬è©¦å·²å®Œæˆ');
        });

        // ç›£è½ PWA äº‹ä»¶
        window.addEventListener('pwaInstallAvailable', function(event) {
            log('ğŸ“± æ”¶åˆ° PWA å®‰è£å¯ç”¨äº‹ä»¶: ' + JSON.stringify(event.detail));
        });

        window.addEventListener('pwaInstallAccepted', function() {
            log('âœ… PWA å®‰è£è¢«æ¥å—');
        });

        window.addEventListener('pwaInstalled', function() {
            log('ğŸ‰ PWA å®‰è£å®Œæˆ');
        });

        // ç›£è½ç‰ˆæœ¬æ›´æ–°äº‹ä»¶
        window.addEventListener('beforeunload', function() {
            log('ğŸ“„ é é¢å³å°‡å¸è¼‰');
        });
    </script>
</body>
</html> 