<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“± Chrome Android å®‰è£æ©«å¹…æ¸¬è©¦ - LingUBible</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#dc2626">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }
        h1 {
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .status.success {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4CAF50;
        }
        .status.warning {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid #FFC107;
        }
        .status.error {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid #F44336;
        }
        .status.info {
            background: rgba(33, 150, 243, 0.3);
            border: 1px solid #2196F3;
        }
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 300px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .chrome-android-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            font-size: 18px;
            padding: 20px 40px;
        }
        .log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            text-align: left;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        .info-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .info-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #4CAF50;
        }
        .info-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }
        .banner-demo {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .banner-demo h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .banner-demo p {
            margin: 5px 0;
            font-size: 14px;
        }
        .banner-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        .banner-buttons button {
            padding: 10px 20px;
            font-size: 14px;
            max-width: none;
            width: auto;
        }
        .install-banner {
            background: #4285f4;
            color: white;
        }
        .dismiss-banner {
            background: #666;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± Chrome Android å®‰è£æ©«å¹…æ¸¬è©¦</h1>
        <p>æ­¤é é¢å°ˆé–€æ¸¬è©¦ Chrome Android ç€è¦½å™¨çš„ PWA å®‰è£æ©«å¹…åŠŸèƒ½</p>

        <div class="test-section">
            <h2>ğŸ” ç’°å¢ƒæª¢æ¸¬</h2>
            <div id="environment-status"></div>
            
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-value" id="is-chrome-android">æª¢æŸ¥ä¸­...</div>
                    <div class="info-label">Chrome Android</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="has-https">æª¢æŸ¥ä¸­...</div>
                    <div class="info-label">HTTPS å”è­°</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="has-manifest">æª¢æŸ¥ä¸­...</div>
                    <div class="info-label">Manifest æ–‡ä»¶</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="has-service-worker">æª¢æŸ¥ä¸­...</div>
                    <div class="info-label">Service Worker</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="user-engagement">æª¢æŸ¥ä¸­...</div>
                    <div class="info-label">ç”¨æˆ¶äº’å‹•</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="install-prompt">æª¢æŸ¥ä¸­...</div>
                    <div class="info-label">å®‰è£æç¤º</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="user-dismissed">æª¢æŸ¥ä¸­...</div>
                    <div class="info-label">ç”¨æˆ¶æ‹’çµ•ç‹€æ…‹</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“± å®‰è£æ©«å¹…æ¨¡æ“¬</h2>
            <div class="banner-demo">
                <h3>ğŸš€ LingUBible å®‰è£æ©«å¹…é è¦½</h3>
                <p>ğŸ“± é€™æ˜¯ Chrome Android å®‰è£æ©«å¹…çš„å¤–è§€ç¤ºä¾‹</p>
                <p>ğŸ¯ çœŸå¯¦çš„æ©«å¹…æœƒåœ¨æ»¿è¶³æ¢ä»¶æ™‚è‡ªå‹•é¡¯ç¤º</p>
                <div class="banner-buttons">
                    <button class="install-banner" onclick="simulateInstall()">å®‰è£</button>
                    <button class="dismiss-banner" onclick="simulateDismiss()">ä¸äº†ï¼Œè¬è¬</button>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ§ª æ¸¬è©¦åŠŸèƒ½</h2>
            <button onclick="triggerUserInteraction()" class="chrome-android-button">ğŸ‘¤ è§¸ç™¼ç”¨æˆ¶äº’å‹•</button>
            <button onclick="checkInstallPrompt()">ğŸ” æª¢æŸ¥å®‰è£æç¤º</button>
            <button onclick="forceInstallBanner()">ğŸš€ å¼·åˆ¶è§¸ç™¼å®‰è£æ©«å¹…</button>
            <button onclick="testManualInstall()">ğŸ“– é¡¯ç¤ºæ‰‹å‹•å®‰è£æŒ‡å¼•</button>
            <button onclick="simulateUserDismissal()">âŒ æ¨¡æ“¬ç”¨æˆ¶æ‹’çµ•</button>
            <button onclick="resetDismissalStatus()">ğŸ”„ é‡ç½®æ‹’çµ•ç‹€æ…‹</button>
            <button onclick="refreshStatus()">ğŸ”„ åˆ·æ–°ç‹€æ…‹</button>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ å¯¦æ™‚æ—¥èªŒ</h2>
            <button onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
            <div id="log" class="log"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ’¡ Chrome Android å®‰è£æ¢ä»¶</h2>
            <div style="text-align: left; font-size: 14px; line-height: 1.6;">
                <p><strong>Chrome Android é¡¯ç¤ºå®‰è£æ©«å¹…éœ€è¦æ»¿è¶³ï¼š</strong></p>
                <ul>
                    <li>âœ… ä½¿ç”¨ Chrome Android ç€è¦½å™¨</li>
                    <li>âœ… ç¶²ç«™ä½¿ç”¨ HTTPS å”è­°</li>
                    <li>âœ… æœ‰æ•ˆçš„ Web App Manifest</li>
                    <li>âœ… è¨»å†Šäº† Service Worker</li>
                    <li>âœ… ç”¨æˆ¶èˆ‡é é¢æœ‰äº’å‹•ï¼ˆé»æ“Šã€æ»¾å‹•ç­‰ï¼‰</li>
                    <li>âœ… æ‡‰ç”¨æœªå®‰è£</li>
                    <li>âœ… æ»¿è¶³ PWA å®‰è£æ¢ä»¶</li>
                </ul>
                <p><strong>å®‰è£æ©«å¹…é€šå¸¸æœƒåœ¨ï¼š</strong></p>
                <ul>
                    <li>ğŸ• é¦–æ¬¡è¨ªå•å¾Œ 30 ç§’å…§</li>
                    <li>ğŸ‘† ç”¨æˆ¶æœ‰äº’å‹•è¡Œç‚ºå¾Œ</li>
                    <li>ğŸ“± æ»¿è¶³æ‰€æœ‰ PWA æ¢ä»¶æ™‚</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥ Service Worker è¨»å†Šè…³æœ¬ -->
    <script src="/sw-register.js"></script>

    <script>
        let logEntries = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            logEntries.push(entry);
            
            const logElement = document.getElementById('log');
            logElement.textContent = logEntries.slice(-30).join('\n');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(message);
        }

        function clearLog() {
            logEntries = [];
            document.getElementById('log').textContent = '';
        }

        function checkEnvironment() {
            const isChromeAndroid = window.PWAInstaller?.isChromeAndroid() || 
                                   (navigator.userAgent.includes('Chrome') && 
                                    navigator.userAgent.includes('Android') && 
                                    !navigator.userAgent.includes('Edge'));
            
            const isHTTPS = window.location.protocol === 'https:';
            const hasManifest = !!document.querySelector('link[rel="manifest"]');
            const hasServiceWorker = 'serviceWorker' in navigator;
            const hasUserEngagement = window.PWAInstaller?.hasUserEngagement() || false;
            const hasInstallPrompt = window.PWAInstaller?.hasPrompt() || false;
            const dismissalStatus = window.PWAInstaller?.getDismissalStatus?.() || { dismissed: false };

            // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
            document.getElementById('is-chrome-android').textContent = isChromeAndroid ? 'âœ… æ˜¯' : 'âŒ å¦';
            document.getElementById('has-https').textContent = isHTTPS ? 'âœ… æ˜¯' : 'âŒ å¦';
            document.getElementById('has-manifest').textContent = hasManifest ? 'âœ… æ˜¯' : 'âŒ å¦';
            document.getElementById('has-service-worker').textContent = hasServiceWorker ? 'âœ… æ˜¯' : 'âŒ å¦';
            document.getElementById('user-engagement').textContent = hasUserEngagement ? 'âœ… å……è¶³' : 'âŒ ä¸è¶³';
            document.getElementById('install-prompt').textContent = hasInstallPrompt ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨';
            document.getElementById('user-dismissed').textContent = dismissalStatus.dismissed ? 'âŒ å·²æ‹’çµ•' : 'âœ… æœªæ‹’çµ•';

            // ç’°å¢ƒç‹€æ…‹ç¸½çµ
            const statusElement = document.getElementById('environment-status');
            let statusClass = 'info';
            let statusText = '';

            if (isChromeAndroid && isHTTPS && hasManifest && hasServiceWorker) {
                if (hasInstallPrompt) {
                    statusClass = 'success';
                    statusText = 'âœ… å®Œç¾ï¼æ‰€æœ‰æ¢ä»¶éƒ½æ»¿è¶³ï¼Œå®‰è£æ©«å¹…æ‡‰è©²æœƒé¡¯ç¤º';
                } else if (hasUserEngagement) {
                    statusClass = 'warning';
                    statusText = 'âš ï¸ æ¢ä»¶æ»¿è¶³ï¼Œç­‰å¾…ç€è¦½å™¨è§¸ç™¼å®‰è£æç¤º';
                } else {
                    statusClass = 'info';
                    statusText = 'ğŸ’¡ æ¢ä»¶æ»¿è¶³ï¼Œéœ€è¦ç”¨æˆ¶äº’å‹•ä¾†è§¸ç™¼å®‰è£æç¤º';
                }
            } else {
                statusClass = 'error';
                statusText = 'âŒ éƒ¨åˆ†æ¢ä»¶ä¸æ»¿è¶³ï¼Œå®‰è£æ©«å¹…å¯èƒ½ä¸æœƒé¡¯ç¤º';
            }

            statusElement.innerHTML = `<div class="status ${statusClass}">${statusText}</div>`;

            log(`ç’°å¢ƒæª¢æ¸¬: Chrome Android=${isChromeAndroid}, HTTPS=${isHTTPS}, Manifest=${hasManifest}, SW=${hasServiceWorker}, äº’å‹•=${hasUserEngagement}, æç¤º=${hasInstallPrompt}, æ‹’çµ•=${dismissalStatus.dismissed}`);
        }

        function triggerUserInteraction() {
            log('ğŸ‘¤ è§¸ç™¼ç”¨æˆ¶äº’å‹•äº‹ä»¶...');
            
            // è§¸ç™¼å„ç¨®ç”¨æˆ¶äº’å‹•äº‹ä»¶
            document.body.click();
            window.scrollBy(0, 1);
            
            const keyEvent = new KeyboardEvent('keydown', { key: 'Space' });
            document.dispatchEvent(keyEvent);
            
            const touchEvent = new TouchEvent('touchstart', {
                touches: [new Touch({
                    identifier: 0,
                    target: document.body,
                    clientX: 100,
                    clientY: 100
                })]
            });
            document.dispatchEvent(touchEvent);
            
            log('å·²è§¸ç™¼ç”¨æˆ¶äº’å‹•äº‹ä»¶');
            
            // å»¶é²æª¢æŸ¥ç‹€æ…‹
            setTimeout(() => {
                checkEnvironment();
            }, 1000);
        }

        function checkInstallPrompt() {
            log('ğŸ” æª¢æŸ¥å®‰è£æç¤ºç‹€æ…‹...');
            
            if (window.PWAInstaller) {
                const hasPrompt = window.PWAInstaller.hasPrompt();
                const hasEngagement = window.PWAInstaller.hasUserEngagement();
                const isChromeAndroid = window.PWAInstaller.isChromeAndroid();
                
                log(`å®‰è£æç¤ºç‹€æ…‹: å¯ç”¨=${hasPrompt}, äº’å‹•=${hasEngagement}, Chrome Android=${isChromeAndroid}`);
                
                if (hasPrompt) {
                    log('âœ… å®‰è£æç¤ºå¯ç”¨ï¼Œå¯ä»¥è§¸ç™¼å®‰è£');
                } else {
                    log('âŒ å®‰è£æç¤ºä¸å¯ç”¨');
                }
            } else {
                log('âŒ PWAInstaller ä¸å¯ç”¨');
            }
            
            checkEnvironment();
        }

        function forceInstallBanner() {
            log('ğŸš€ å˜—è©¦å¼·åˆ¶è§¸ç™¼å®‰è£æ©«å¹…...');
            
            if (window.PWAInstaller?.triggerInstallBanner) {
                log('è§¸ç™¼ Chrome Android å®‰è£æ©«å¹…...');
                window.PWAInstaller.triggerInstallBanner();
            } else if (window.PWAInstaller?.triggerInstallPrompt) {
                log('è§¸ç™¼é€šç”¨å®‰è£æç¤º...');
                window.PWAInstaller.triggerInstallPrompt();
            } else {
                log('âŒ å®‰è£åŠŸèƒ½ä¸å¯ç”¨');
                alert('å®‰è£åŠŸèƒ½ä¸å¯ç”¨ï¼Œè«‹æª¢æŸ¥ç’°å¢ƒæ¢ä»¶ã€‚');
            }
        }

        function testManualInstall() {
            log('ğŸ“– é¡¯ç¤ºæ‰‹å‹•å®‰è£æŒ‡å¼•...');
            
            if (window.PWAInstaller?.showManualInstructions) {
                window.PWAInstaller.showManualInstructions();
            } else {
                alert('æ‰‹å‹•å®‰è£æŒ‡å¼•åŠŸèƒ½ä¸å¯ç”¨ã€‚');
            }
        }

        function simulateInstall() {
            log('âœ… æ¨¡æ“¬ç”¨æˆ¶é»æ“Šã€Œå®‰è£ã€æŒ‰éˆ•');
            alert('ğŸ‰ æ¨¡æ“¬å®‰è£æˆåŠŸï¼åœ¨çœŸå¯¦ç’°å¢ƒä¸­ï¼Œæ‡‰ç”¨æœƒè¢«å®‰è£åˆ°è¨­å‚™ä¸Šã€‚');
        }

        function simulateDismiss() {
            log('âŒ æ¨¡æ“¬ç”¨æˆ¶é»æ“Šã€Œä¸äº†ï¼Œè¬è¬ã€æŒ‰éˆ•');
            alert('ğŸ˜” æ¨¡æ“¬ç”¨æˆ¶æ‹’çµ•å®‰è£ã€‚Chrome æœƒè¨˜ä½é€™å€‹é¸æ“‡ã€‚');
        }

        function simulateUserDismissal() {
            log('âŒ æ¨¡æ“¬ç”¨æˆ¶æ‹’çµ•å®‰è£');
            
            // æ¨¡æ“¬ç”¨æˆ¶æ‹’çµ•ï¼Œè§¸ç™¼æ‹’çµ•äº‹ä»¶
            window.dispatchEvent(new CustomEvent('pwaInstallDismissed'));
            
            // å»¶é²æª¢æŸ¥ç‹€æ…‹
            setTimeout(() => {
                checkEnvironment();
                log('å·²æ¨¡æ“¬ç”¨æˆ¶æ‹’çµ•ï¼Œ24 å°æ™‚å…§ä¸æœƒå†é¡¯ç¤ºå®‰è£æç¤º');
            }, 500);
        }

        function resetDismissalStatus() {
            log('ğŸ”„ é‡ç½®æ‹’çµ•ç‹€æ…‹');
            
            if (window.PWAInstaller?.resetDismissal) {
                window.PWAInstaller.resetDismissal();
                log('âœ… æ‹’çµ•ç‹€æ…‹å·²é‡ç½®ï¼Œé‡æ–°å•Ÿç”¨å®‰è£æç¤º');
                
                // å»¶é²æª¢æŸ¥ç‹€æ…‹
                setTimeout(() => {
                    checkEnvironment();
                }, 500);
            } else {
                log('âŒ é‡ç½®åŠŸèƒ½ä¸å¯ç”¨');
                alert('é‡ç½®åŠŸèƒ½ä¸å¯ç”¨ï¼Œè«‹æª¢æŸ¥ PWAInstallerã€‚');
            }
        }

        function refreshStatus() {
            log('ğŸ”„ åˆ·æ–°ç‹€æ…‹...');
            checkEnvironment();
        }

        // ç›£è½ PWA ç›¸é—œäº‹ä»¶
        window.addEventListener('beforeinstallprompt', function(event) {
            log('ğŸ’¡ æ”¶åˆ° beforeinstallprompt äº‹ä»¶ï¼');
            log('ğŸ¯ é€™æ„å‘³è‘— Chrome æº–å‚™é¡¯ç¤ºå®‰è£æ©«å¹…');
            checkEnvironment();
        });

        window.addEventListener('pwaInstallAvailable', function(event) {
            log('ğŸ“± æ”¶åˆ° PWA å®‰è£å¯ç”¨äº‹ä»¶: ' + JSON.stringify(event.detail));
            checkEnvironment();
        });

        window.addEventListener('pwaInstallAccepted', function() {
            log('âœ… PWA å®‰è£è¢«æ¥å—');
            checkEnvironment();
        });

        window.addEventListener('pwaInstallDismissed', function() {
            log('âŒ PWA å®‰è£è¢«æ‹’çµ•');
            checkEnvironment();
        });

        window.addEventListener('appinstalled', function() {
            log('ğŸ‰ PWA å®‰è£å®Œæˆ');
            checkEnvironment();
        });

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.addEventListener('load', function() {
            log('ğŸ“± Chrome Android å®‰è£æ©«å¹…æ¸¬è©¦é é¢å·²è¼‰å…¥');
            
            // å»¶é²æª¢æŸ¥ç’°å¢ƒï¼Œç­‰å¾… Service Worker è¼‰å…¥
            setTimeout(() => {
                checkEnvironment();
                log('åˆå§‹åŒ–å®Œæˆ');
                
                // å¦‚æœæ˜¯ Chrome Androidï¼Œé¡¯ç¤ºç‰¹åˆ¥æç¤º
                if (window.PWAInstaller?.isChromeAndroid()) {
                    log('ğŸ¯ æª¢æ¸¬åˆ° Chrome Androidï¼Œå®‰è£æ©«å¹…æ‡‰è©²æœƒåœ¨ç”¨æˆ¶äº’å‹•å¾Œé¡¯ç¤º');
                }
            }, 2000);
        });

        // è‡ªå‹•è§¸ç™¼ç”¨æˆ¶äº’å‹•ï¼ˆç”¨æ–¼æ¸¬è©¦ï¼‰
        setTimeout(() => {
            if (window.PWAInstaller?.isChromeAndroid()) {
                log('ğŸ¤– è‡ªå‹•è§¸ç™¼ç”¨æˆ¶äº’å‹•ï¼ˆæ¸¬è©¦ç”¨ï¼‰');
                triggerUserInteraction();
            }
        }, 3000);
    </script>
</body>
</html> 