<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA ç”¨æˆ¶åƒèˆ‡åº¦æ¸¬è©¦ - LingUBible</title>
    <link rel="manifest" href="/manifest.webmanifest">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        .info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        .counter {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }
        .engagement-meter {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .engagement-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545, #ffc107, #28a745);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ PWA ç”¨æˆ¶åƒèˆ‡åº¦æ¸¬è©¦</h1>
    <p>é€™å€‹é é¢ç”¨æ–¼æ¸¬è©¦ PWA å®‰è£çš„ç”¨æˆ¶åƒèˆ‡åº¦è¦æ±‚ã€‚Chrome éœ€è¦ç”¨æˆ¶æœ‰è¶³å¤ çš„äº’å‹•æ‰æœƒé¡¯ç¤ºå®‰è£æç¤ºã€‚</p>

    <div class="status info">
        <strong>æ¸¬è©¦èªªæ˜:</strong> é»æ“ŠæŒ‰éˆ•ã€æ»¾å‹•é é¢ã€è¼¸å…¥æ–‡å­—ä¾†å¢åŠ ç”¨æˆ¶åƒèˆ‡åº¦
    </div>

    <div class="counter">
        äº’å‹•æ¬¡æ•¸: <span id="interaction-count">0</span>
    </div>

    <div class="engagement-meter">
        <div class="engagement-fill" id="engagement-fill" style="width: 0%"></div>
    </div>

    <div class="test-button" onclick="simulateInteraction()">é»æ“Šæ¸¬è©¦ (+1 äº’å‹•)</div>
    <div class="test-button" onclick="triggerInstall()">å˜—è©¦è§¸ç™¼å®‰è£</div>
    <div class="test-button" onclick="checkPWAStatus()">æª¢æŸ¥ PWA ç‹€æ…‹</div>

    <div>
        <h3>ğŸ“ æ¸¬è©¦è¼¸å…¥å€åŸŸ</h3>
        <textarea placeholder="åœ¨é€™è£¡è¼¸å…¥æ–‡å­—ä¾†å¢åŠ äº’å‹•..." style="width: 100%; height: 100px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;"></textarea>
    </div>

    <div>
        <h3>ğŸ“Š æ»¾å‹•æ¸¬è©¦å€åŸŸ</h3>
        <div style="height: 200px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; border-radius: 5px;">
            <p>æ»¾å‹•é€™å€‹å€åŸŸä¾†å¢åŠ ç”¨æˆ¶äº’å‹•...</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
            <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
            <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
            <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium.</p>
            <p>Totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt.</p>
        </div>
    </div>

    <div id="status-display"></div>

    <script>
        let interactionCount = 0;
        let deferredPrompt = null;
        let installPromptAvailable = false;

        // æ›´æ–°é¡¯ç¤º
        function updateDisplay() {
            document.getElementById('interaction-count').textContent = interactionCount;
            const percentage = Math.min(interactionCount * 10, 100);
            document.getElementById('engagement-fill').style.width = percentage + '%';
        }

        // æ¨¡æ“¬äº’å‹•
        function simulateInteraction() {
            interactionCount++;
            updateDisplay();
            console.log('ğŸ¯ ç”¨æˆ¶äº’å‹• +1, ç¸½è¨ˆ:', interactionCount);
            
            if (interactionCount >= 5) {
                showStatus('success', 'âœ… ç”¨æˆ¶åƒèˆ‡åº¦å……è¶³ï¼PWA å®‰è£æç¤ºæ‡‰è©²å¯ç”¨');
            } else if (interactionCount >= 3) {
                showStatus('warning', 'âš ï¸ ç”¨æˆ¶åƒèˆ‡åº¦ä¸­ç­‰ï¼Œç¹¼çºŒäº’å‹•å¯èƒ½æœ‰åŠ©æ–¼ PWA å®‰è£');
            } else {
                showStatus('info', 'ğŸ“Š ç”¨æˆ¶åƒèˆ‡åº¦è¼ƒä½ï¼Œéœ€è¦æ›´å¤šäº’å‹•');
            }
        }

        // é¡¯ç¤ºç‹€æ…‹
        function showStatus(type, message) {
            const statusDiv = document.getElementById('status-display');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // æª¢æŸ¥ PWA ç‹€æ…‹
        function checkPWAStatus() {
            const status = {
                installPromptAvailable: !!deferredPrompt,
                serviceWorkerSupported: 'serviceWorker' in navigator,
                isHTTPS: location.protocol === 'https:',
                isStandalone: window.matchMedia('(display-mode: standalone)').matches,
                userAgent: navigator.userAgent,
                interactionCount: interactionCount
            };

            console.log('ğŸ” PWA ç‹€æ…‹æª¢æŸ¥:', status);
            
            let message = 'ğŸ“Š PWA ç‹€æ…‹æª¢æŸ¥:<br>';
            message += `- å®‰è£æç¤ºå¯ç”¨: ${status.installPromptAvailable ? 'âœ…' : 'âŒ'}<br>`;
            message += `- Service Worker: ${status.serviceWorkerSupported ? 'âœ…' : 'âŒ'}<br>`;
            message += `- HTTPS: ${status.isHTTPS ? 'âœ…' : 'âŒ'}<br>`;
            message += `- å·²å®‰è£: ${status.isStandalone ? 'âœ…' : 'âŒ'}<br>`;
            message += `- äº’å‹•æ¬¡æ•¸: ${status.interactionCount}<br>`;
            
            const isChrome = navigator.userAgent.includes('Chrome') && !navigator.userAgent.includes('Edg');
            const isEdge = navigator.userAgent.includes('Edg');
            message += `- ç€è¦½å™¨æ”¯æ´: ${isChrome ? 'Chrome âœ…' : isEdge ? 'Edge âœ…' : 'å¯èƒ½ä¸æ”¯æ´ âŒ'}`;

            showStatus('info', message);
        }

        // å˜—è©¦è§¸ç™¼å®‰è£
        function triggerInstall() {
            if (deferredPrompt) {
                console.log('ğŸš€ è§¸ç™¼ PWA å®‰è£æç¤º');
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    console.log('ğŸ‘¤ ç”¨æˆ¶é¸æ“‡:', choiceResult.outcome);
                    showStatus(choiceResult.outcome === 'accepted' ? 'success' : 'warning', 
                              `ç”¨æˆ¶${choiceResult.outcome === 'accepted' ? 'æ¥å—' : 'æ‹’çµ•'}äº†å®‰è£`);
                    deferredPrompt = null;
                });
            } else {
                showStatus('warning', 'âš ï¸ å®‰è£æç¤ºä¸å¯ç”¨ã€‚è«‹å˜—è©¦æ›´å¤šäº’å‹•æˆ–æª¢æŸ¥ç€è¦½å™¨æ”¯æ´ã€‚');
                console.log('âš ï¸ å®‰è£æç¤ºä¸å¯ç”¨');
            }
        }

        // ç›£è½ beforeinstallprompt äº‹ä»¶
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installPromptAvailable = true;
            console.log('ğŸ’¡ PWA å®‰è£æç¤ºå¯ç”¨!', e);
            showStatus('success', 'ğŸ‰ PWA å®‰è£æç¤ºå·²å¯ç”¨ï¼å¯ä»¥å˜—è©¦å®‰è£äº†ã€‚');
        });

        // ç›£è½å®‰è£å®Œæˆäº‹ä»¶
        window.addEventListener('appinstalled', (e) => {
            console.log('ğŸ‰ PWA å®‰è£å®Œæˆ', e);
            showStatus('success', 'ğŸ‰ PWA å®‰è£å®Œæˆï¼');
        });

        // è‡ªå‹•è¿½è¹¤å„ç¨®äº’å‹•
        ['click', 'scroll', 'keydown', 'touchstart', 'input'].forEach(eventType => {
            document.addEventListener(eventType, () => {
                if (eventType !== 'click' || !event.target.classList.contains('test-button')) {
                    simulateInteraction();
                }
            }, { passive: true });
        });

        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥ç‹€æ…‹
        window.addEventListener('load', () => {
            setTimeout(checkPWAStatus, 2000);
        });
    </script>
</body>
</html> 