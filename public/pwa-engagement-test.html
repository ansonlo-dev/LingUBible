<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA 用戶參與度測試 - LingUBible</title>
    <link rel="manifest" href="/manifest.webmanifest">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        .info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        .counter {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }
        .engagement-meter {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .engagement-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545, #ffc107, #28a745);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <h1>🎯 PWA 用戶參與度測試</h1>
    <p>這個頁面用於測試 PWA 安裝的用戶參與度要求。Chrome 需要用戶有足夠的互動才會顯示安裝提示。</p>

    <div class="status info">
        <strong>測試說明:</strong> 點擊按鈕、滾動頁面、輸入文字來增加用戶參與度
    </div>

    <div class="counter">
        互動次數: <span id="interaction-count">0</span>
    </div>

    <div class="engagement-meter">
        <div class="engagement-fill" id="engagement-fill" style="width: 0%"></div>
    </div>

    <div class="test-button" onclick="simulateInteraction()">點擊測試 (+1 互動)</div>
    <div class="test-button" onclick="triggerInstall()">嘗試觸發安裝</div>
    <div class="test-button" onclick="checkPWAStatus()">檢查 PWA 狀態</div>

    <div>
        <h3>📝 測試輸入區域</h3>
        <textarea placeholder="在這裡輸入文字來增加互動..." style="width: 100%; height: 100px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;"></textarea>
    </div>

    <div>
        <h3>📊 滾動測試區域</h3>
        <div style="height: 200px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; border-radius: 5px;">
            <p>滾動這個區域來增加用戶互動...</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
            <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
            <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
            <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium.</p>
            <p>Totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt.</p>
        </div>
    </div>

    <div id="status-display"></div>

    <script>
        let interactionCount = 0;
        let deferredPrompt = null;
        let installPromptAvailable = false;

        // 更新顯示
        function updateDisplay() {
            document.getElementById('interaction-count').textContent = interactionCount;
            const percentage = Math.min(interactionCount * 10, 100);
            document.getElementById('engagement-fill').style.width = percentage + '%';
        }

        // 模擬互動
        function simulateInteraction() {
            interactionCount++;
            updateDisplay();
            console.log('🎯 用戶互動 +1, 總計:', interactionCount);
            
            if (interactionCount >= 5) {
                showStatus('success', '✅ 用戶參與度充足！PWA 安裝提示應該可用');
            } else if (interactionCount >= 3) {
                showStatus('warning', '⚠️ 用戶參與度中等，繼續互動可能有助於 PWA 安裝');
            } else {
                showStatus('info', '📊 用戶參與度較低，需要更多互動');
            }
        }

        // 顯示狀態
        function showStatus(type, message) {
            const statusDiv = document.getElementById('status-display');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // 檢查 PWA 狀態
        function checkPWAStatus() {
            const status = {
                installPromptAvailable: !!deferredPrompt,
                serviceWorkerSupported: 'serviceWorker' in navigator,
                isHTTPS: location.protocol === 'https:',
                isStandalone: window.matchMedia('(display-mode: standalone)').matches,
                userAgent: navigator.userAgent,
                interactionCount: interactionCount
            };

            console.log('🔍 PWA 狀態檢查:', status);
            
            let message = '📊 PWA 狀態檢查:<br>';
            message += `- 安裝提示可用: ${status.installPromptAvailable ? '✅' : '❌'}<br>`;
            message += `- Service Worker: ${status.serviceWorkerSupported ? '✅' : '❌'}<br>`;
            message += `- HTTPS: ${status.isHTTPS ? '✅' : '❌'}<br>`;
            message += `- 已安裝: ${status.isStandalone ? '✅' : '❌'}<br>`;
            message += `- 互動次數: ${status.interactionCount}<br>`;
            
            const isChrome = navigator.userAgent.includes('Chrome') && !navigator.userAgent.includes('Edg');
            const isEdge = navigator.userAgent.includes('Edg');
            message += `- 瀏覽器支援: ${isChrome ? 'Chrome ✅' : isEdge ? 'Edge ✅' : '可能不支援 ❌'}`;

            showStatus('info', message);
        }

        // 嘗試觸發安裝
        function triggerInstall() {
            if (deferredPrompt) {
                console.log('🚀 觸發 PWA 安裝提示');
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    console.log('👤 用戶選擇:', choiceResult.outcome);
                    showStatus(choiceResult.outcome === 'accepted' ? 'success' : 'warning', 
                              `用戶${choiceResult.outcome === 'accepted' ? '接受' : '拒絕'}了安裝`);
                    deferredPrompt = null;
                });
            } else {
                showStatus('warning', '⚠️ 安裝提示不可用。請嘗試更多互動或檢查瀏覽器支援。');
                console.log('⚠️ 安裝提示不可用');
            }
        }

        // 監聽 beforeinstallprompt 事件
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installPromptAvailable = true;
            console.log('💡 PWA 安裝提示可用!', e);
            showStatus('success', '🎉 PWA 安裝提示已可用！可以嘗試安裝了。');
        });

        // 監聽安裝完成事件
        window.addEventListener('appinstalled', (e) => {
            console.log('🎉 PWA 安裝完成', e);
            showStatus('success', '🎉 PWA 安裝完成！');
        });

        // 自動追蹤各種互動
        ['click', 'scroll', 'keydown', 'touchstart', 'input'].forEach(eventType => {
            document.addEventListener(eventType, () => {
                if (eventType !== 'click' || !event.target.classList.contains('test-button')) {
                    simulateInteraction();
                }
            }, { passive: true });
        });

        // 頁面載入時檢查狀態
        window.addEventListener('load', () => {
            setTimeout(checkPWAStatus, 2000);
        });
    </script>
</body>
</html> 