name: ðŸ“š Documentation Sync Check

on:
  push:
    paths:
      - 'docs/**'
      - 'README.md'
  pull_request:
    paths:
      - 'docs/**'
      - 'README.md'

jobs:
  check-docs-sync:
    name: Check Documentation Sync
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
        
      - name: ðŸ“‹ Check multilingual documentation structure
        run: |
          echo "ðŸ” Checking multilingual documentation structure..."
          
          # Check if all language directories exist
          languages=("zh-TW" "zh-CN")
          for lang in "${languages[@]}"; do
            if [ ! -d "docs/$lang" ]; then
              echo "âŒ Missing language directory: docs/$lang"
              exit 1
            else
              echo "âœ… Found language directory: docs/$lang"
            fi
          done
          
          # Check if README files exist for all languages
          if [ ! -f "README.md" ]; then
            echo "âŒ Missing root README.md"
            exit 1
          fi
          
          for lang in "${languages[@]}"; do
            if [ ! -f "docs/$lang/README.md" ]; then
              echo "âŒ Missing README.md for language: $lang"
              exit 1
            else
              echo "âœ… Found README.md for language: $lang"
            fi
          done
          
          # Check if language badges exist in README files
          echo "ðŸ·ï¸ Checking language badges..."
          
          if ! grep -q "Language-English-blue" README.md; then
            echo "âŒ Missing English language badge in root README.md"
            exit 1
          fi
          
          if ! grep -q "Language-ç¹é«”ä¸­æ–‡-red" README.md; then
            echo "âŒ Missing Traditional Chinese language badge in root README.md"
            exit 1
          fi
          
          if ! grep -q "Language-ç®€ä½“ä¸­æ–‡-green" README.md; then
            echo "âŒ Missing Simplified Chinese language badge in root README.md"
            exit 1
          fi
          
          echo "âœ… All language badges found in README.md"
          
          # Check subdirectory structure
          subdirs=("setup" "features" "deployment" "testing")
          for lang in "${languages[@]}"; do
            for subdir in "${subdirs[@]}"; do
              if [ ! -d "docs/$lang/$subdir" ]; then
                echo "âŒ Missing subdirectory: docs/$lang/$subdir"
                exit 1
              else
                echo "âœ… Found subdirectory: docs/$lang/$subdir"
              fi
            done
          done
          
          echo "ðŸŽ‰ All documentation structure checks passed!"
          
      - name: ðŸ“Š Generate documentation report
        run: |
          echo "ðŸ“Š Documentation Structure Report" > docs-report.md
          echo "=================================" >> docs-report.md
          echo "" >> docs-report.md
          echo "## ðŸŒ Available Languages" >> docs-report.md
          echo "" >> docs-report.md
          echo "- âœ… English (en) - Root README.md" >> docs-report.md
          echo "- âœ… Traditional Chinese (zh-TW) - docs/zh-TW/" >> docs-report.md
          echo "- âœ… Simplified Chinese (zh-CN) - docs/zh-CN/" >> docs-report.md
          echo "" >> docs-report.md
          echo "## ðŸ“ Documentation Structure" >> docs-report.md
          echo "" >> docs-report.md
          
          # Count files in each language directory
          echo "### English Documentation" >> docs-report.md
          find docs -maxdepth 2 -name "*.md" -not -path "*/zh-*/*" | wc -l | xargs echo "- Files:" >> docs-report.md
          
          echo "" >> docs-report.md
          echo "### Traditional Chinese Documentation" >> docs-report.md
          find docs/zh-TW -name "*.md" 2>/dev/null | wc -l | xargs echo "- Files:" >> docs-report.md
          
          echo "" >> docs-report.md
          echo "### Simplified Chinese Documentation" >> docs-report.md
          find docs/zh-CN -name "*.md" 2>/dev/null | wc -l | xargs echo "- Files:" >> docs-report.md
          
          echo "" >> docs-report.md
          echo "## ðŸ”— Cross-Language Links" >> docs-report.md
          echo "" >> docs-report.md
          echo "All README files should contain language switcher badges linking to:" >> docs-report.md
          echo "- English: README.md" >> docs-report.md
          echo "- Traditional Chinese: docs/zh-TW/README.md" >> docs-report.md
          echo "- Simplified Chinese: docs/zh-CN/README.md" >> docs-report.md
          
          cat docs-report.md
          
      - name: ðŸ’¬ Comment on PR (if applicable)
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const report = fs.readFileSync('docs-report.md', 'utf8');
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## ðŸ“š Documentation Structure Check\n\n\`\`\`\n${report}\n\`\`\``
            }); 